#include "proto.h"
#include "channels.h"
#include "tablo.h"
#include "tablo_parser.h"

 extern struct Channel  channels[];//ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалєлаРђџлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алалЈ ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алалІлалјл▓лѓЛџла┬алњ┬алалјл▓лѓЛюла┬алалІлалєлаРђџлАРёбла┬алалІлалјл▓лѓЛџла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬а
 extern struct tablo tab;//ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алалІлалјл▓лѓЛџла┬алњ┬алалјл▓лѓЛюла┬алалІлалєлаРђџлАРёбла┬алалІлалјл▓лѓЛџла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ ла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛъ

//typedef enum {FAILED = 0, PASSED = !FAILED} TestStatus;
//-----------------------------------------------------------------------------------
uint8_t   DEV_NAME[DEVICE_NAME_LENGTH_SYM] ="<<TABLO>>"; //ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁла┬алалІла┬алалЈ ла┬алалІлалјл▓лѓЛџла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░
uint8_t   NOTICE[DEVICE_DESC_MAX_LENGTH_SYM]="<-- GEOSPHERA_2013 -->";//ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬х
uint8_t   VERSION[DEVICE_VER_LENGTH_SYM] ="\x30\x30\x30\x30\x31";	// ла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алалјл┐ЛЌлЁла┬алалІлалєлаРђџл▓РђъРђЊ ла┬алњ┬алалјлАЛЪла┬алњ┬алалєлаРђџл▓лѓЛюла┬алњ┬ала┬ал▓Рђџ┬г	ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬х ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬алаРђ░ла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алаРђЎлњ┬х 5 ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІлалєлаРђџлАРёб

uint8_t   ADRESS_DEV=0xF;

uint8_t   dev_desc_len=20;//ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ ла┬алалІлалјл▓лѓЛџла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░
//--------------------------------global variable------------------------------------

uint8_t   	recieve_count;//ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёбла┬алалІлалєлаРђџлалІла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛю ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░
uint8_t  	transf_count;//ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёбла┬алалІлалєлаРђџлалІла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛю ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬а
uint8_t  	buf_len;//ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░

//------------------------ла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓЛю--------------------------------
uint8_t   crc_n_ERR;	//ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ ла┬алалІла┬алАРђюrc
uint8_t   COMMAND_ERR;//ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬Хла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алалЈ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░



uint8_t   CUT_OUT_NULL;//ла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђю-ла┬алњ┬ала┬ал▓лѓ┬ала┬алалІлалєлаРђџл▓РђъРђЊла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ 0 ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬х 0xD7
uint8_t   frame_len=0;//ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░, ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алалІла┬ал▓лѓЛЎла┬алалІлалјл▓лѓЛџла┬алалІла┬ал▓лѓРёќ ла┬алњ┬ала┬ал▓лѓ┬ала┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬и ла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алаРђЎлњ┬хла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░
//--------------------------------------------------------------------
//volatile  uint8_t    RecieveBuf[MAX_LENGTH_REC_BUF]={0} ; //ла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎ ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д
uint8_t    *RecieveBuf;
uint8_t    *TransferBuf;

//volatile uint8_t /*data*/   TransferBuf[MAX_LENGTH_TR_BUF] ; //ла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д
//--------------------------------------------------------------------
uint8_t    STATE_BYTE=0xC0;//ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІлалєлаРђџлАРёб ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алалЈла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ ла┬алалІлалјл▓лѓЛџла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░



uint16_t fr_err=0;

uint8_t  symbol=0xFF;//ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алалІла┬алалЈла┬алалІлалєлаРђџлАРёбла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алалєл▓лѓЛЏл▓лѓРђю ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗

uint8_t	proto_type=PROTO_TYPE_NEW;//ла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓРђЮ ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░

const uint8_t standby_frame[256]={0x3A,0x7C,0x5B,0x00,0x2E,0x2E,0x2E,0x5D,0x5B,0x01,0x2E,0x2E,0x2E,0x5D,0x5B,0x02,0x2E,0x2E,0x2E,0x5D,0x5B,0x03,0x2E,0x2E,0x2E,0x5D,0x5B,0x04,0x2E,0x2E,0x2E,0x5D,0x5B,0x05,0x2E,0x2E,0x2E,0x5D,0x5B,0x06,0x2E,0x2E,0x2E,0x5D,0x5B,0x07,0x2E,0x2E,0x2E,0x5D,0x5B,0x08,0x2E,0x2E,0x2E,0x2E,0x2E,0x5D,0x5B,0x0A,0x2E,0x2E,0x2E,0x2E,0x2E,0x5D,0x5B,0x0B,0x2E,0x2E,0x2E,0x5D,0x5B,0x0C,0x2E,0x2E,0x2E,0x2E,0x2E,0x5D,0x5B,0x0D,0x00,0x00,0x00,0xFF,0x5D,0x5B,0x0E,0x00,0x00,0x00,0xFF,0x5D,0x5B,0x0F,0x00,0x00,0x00,0xFF,0x5D,0x5B,0x10,0x00,0x00,0x00,0xFF,0x5D,0x5B,0x12,0x00,0x00,0x00,0xFF,0x5D,0x5B,0x13,0x00,0x00,0x00,0xFF,0x5D,0x5B,0x2A,0x07,0x5D};
//-----------------------------------------------------------------------------------
union
{
	float result_float;
	uint8_t result_char[4];
}
sym_8_to_float;

xSemaphoreHandle xProtoSemaphore;

void USART6_IRQHandler (void)
{
 	static portBASE_TYPE xHigherPriorityTaskWoken;
 	  xHigherPriorityTaskWoken = pdFALSE;

//

 	if(USART_GetITStatus(USART6, USART_IT_RXNE) != RESET)
   	{
 		USART_ClearITPendingBit(USART6, USART_IT_RXNE);

   		symbol=USART_ReceiveData (USART6);

   		if(recieve_count>MAX_LENGTH_REC_BUF)
   		{
   			recieve_count=0x0;
   			return;
   		}

switch(proto_type)
{
	case PROTO_TYPE_OLD:
	{
		if(symbol==':')
		{
			recieve_count=0x0;
		}

		tab.tablo_proto_buf[recieve_count]=symbol;
		recieve_count++;

		if(recieve_count>1)
		{
			if(tab.tablo_proto_buf[1]==(recieve_count-2))//
			{
				 USART_ITConfig(USART6, USART_IT_RXNE , DISABLE);
				xSemaphoreGiveFromISR( xProtoSemaphore, &xHigherPriorityTaskWoken );

  				 if( xHigherPriorityTaskWoken != pdFALSE )
  				 {
  					portEND_SWITCHING_ISR( xHigherPriorityTaskWoken );
  				 }
			}
		}
	}
	break;

	case PROTO_TYPE_NEW:
	{
	//--------------------------

		switch(symbol)
		{
			case (char)(0xD7):
			{
				RecieveBuf[recieve_count]=symbol;
				recieve_count++;
				CUT_OUT_NULL=1;
			}
			break;

			case (char)(0x29):
			{
				if(CUT_OUT_NULL==1)
				{
					RecieveBuf[0]=0x0;
					RecieveBuf[1]=0xD7;
					RecieveBuf[2]=0x29;
					recieve_count=0x3;
				}
				else
				{
					RecieveBuf[recieve_count]=symbol;
					recieve_count++;
				}
				CUT_OUT_NULL=0;
			}
			break;

			case (char)(0x0):
			{
				if(CUT_OUT_NULL==1)	  //тывУ №Ьывт 0xD7-№­Ь№зыЖЯтВ
				{
					CUT_OUT_NULL=0;
				}
				else
				{
					RecieveBuf[recieve_count]=symbol;
					recieve_count++;
				}
			}
			break;

			default :
			{
				RecieveBuf[recieve_count]=symbol;
				recieve_count++;
				CUT_OUT_NULL=0;

			}
		}

	   if(recieve_count>6)
	   {
			  if(recieve_count==6+frame_len)	  // №­УьУВЯтВ зЖЯуЯььЬт Р frame_len эУывЬ рЯжЫ СЯььчт, 6 уьЯэУЫ эЫЬ ЬрВть УСтЫ ы ЖЬВ№ЬВ, ьЯСЬ ыЫЯРЯУЫЧ 5 эЫЬрч ЬрВтьУРЯЫЧы  ы зыЫ­ЬжыЫРЯВУ
			  {
					 USART_ITConfig(USART6, USART_IT_RXNE , DISABLE);

					 xSemaphoreGiveFromISR( xProtoSemaphore, &xHigherPriorityTaskWoken );

					 if( xHigherPriorityTaskWoken != pdFALSE )
					 {
						portEND_SWITCHING_ISR( xHigherPriorityTaskWoken );
					 }
					 CUT_OUT_NULL=0;
			  }
	   }
	   else
	   {
			   if(recieve_count==6)
			   {
					frame_len=RecieveBuf[recieve_count-1];  // №ЬвзэЯтВ СвУьз СЯььчш №Ьывт уЯсЬвЬРЖЯ
			   }
	   }
//   	    if(recieve_count<6)
//   		{
//   	    		switch(recieve_count)
//   				{
//   					case  0:   //
//   					{
//   	 				 	 if(symbol!=0x00)
//   						 {
//   	 				 		recieve_count=0;
//
//   	 				 	fr_err++;
//   							//return;
//   						 }
//   					}
//   					break;
//
//   					case 1:	 //
//   					{
//   						 if(symbol!=0xD7)
//   						 {
//   							recieve_count=0;
//
//   							//return;
//   						 }
//   					}
//   					break;
//
//   					case 2:	 //
//   					{
//   					 	 if(symbol!=0x29)
//   						 {
//   					 		recieve_count=0;
//
//   							//return;
//   						 }
//   					}
//   					break;
//
//   					case 3:	//
//   					{
//   						if(symbol!=ADRESS_DEV)//
//   						{
//   							recieve_count=0;
//
//   							//return;
//   						}
//   					}
//   					break;
//
//   					default:  //
//   					{
//   					}
//   					break;
//   				}
//
//   			RecieveBuf[recieve_count]=symbol;//
//   			recieve_count++;//
//
//   			if(recieve_count==6)
//   			{
//   				frame_len=RecieveBuf[recieve_count-1]; //
//   			}
//   		}
//   //---------------------------------------------------------
//   		else  //
//   		{
//   			switch(symbol)//
//   			{
//   				case 0xD7:
//   				{
//   					CUT_OUT_NULL=1;	//
//   					RecieveBuf[recieve_count]=symbol;
//   					recieve_count++;
//
//   				}
//   				break;
//
//   				case 0x0:
//   				{
//   					if(!CUT_OUT_NULL)  //
//   					{
//   						RecieveBuf[recieve_count]=symbol;
//   						recieve_count++;
//   					}
//   					else //
//   					{
//   						CUT_OUT_NULL=0;
//   					}
//   				}
//   				break;
//
//   				default:  //
//   				{
//   					CUT_OUT_NULL=0;
//   					RecieveBuf[recieve_count]=symbol;
//   					recieve_count++;
//   				}
//   				break;
//   			}
//
//   			if(recieve_count>=frame_len+6)//
//   			{
//   				 USART_ITConfig(USART6, USART_IT_RXNE , DISABLE);
//
//   				 xSemaphoreGiveFromISR( xProtoSemaphore, &xHigherPriorityTaskWoken );
//
//   				 if( xHigherPriorityTaskWoken != pdFALSE )
//   				 {
//   					portEND_SWITCHING_ISR( xHigherPriorityTaskWoken );
//   				 }
//   			}
//   		}
	}
}

   	}
   //-----------------------------------------------------------------------------------------------------------------
   	if(USART_GetITStatus(USART6, USART_IT_TC) != RESET)
   	{

   		USART_ClearITPendingBit(USART6, USART_IT_TC);//ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлалІла┬алњ┬алалјл▓лѓ№┐йла┬алалІлалєлаРђџлњ┬░ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬ила┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓЛю ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ

   		if(transf_count<buf_len)
   		{
   			if(transf_count<3)//ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ ла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓЛю
   			{
   				//USART_SendData(USART6,TransferBuf[transf_count]);
   				USART6->DR =TransferBuf[transf_count];
   				transf_count++;
   			}
   			else   //ла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛъ...   ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬алалЈла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ 0 ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬х 0xD7
   			{
   					if(CUT_OUT_NULL==0)
   					{
   						if(TransferBuf[transf_count]==(uint8_t)0xD7)//ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁ, ла┬алалІла┬алалЅла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъ  ,0xD7 ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬ал▓лѓЛЎла┬алалІлалјл▓лѓЛџла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬х
   						{
   							CUT_OUT_NULL=0x1;
   						}
   						//USART_SendData(USART6,TransferBuf[transf_count]);
   						USART6->DR =TransferBuf[transf_count];
   						transf_count++;
   					}
   					else
   					{
   						//USART_SendData(USART6,(uint8_t)0x0);
   						USART6->DR =(uint8_t)0x0 ;
   						CUT_OUT_NULL=0;
   					}
   			}
   		}
   		else
   		{
   			transf_count=0;		//ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалјл▓лѓЛџла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬алалЈла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёбла┬алалІлалєлаРђџлалІла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛю
   			recieve_count=0;

   			CUT_OUT_NULL=0;
   			 USART_ITConfig(USART6, USART_IT_RXNE , ENABLE);
   		}

   	}
   	portEND_SWITCHING_ISR( xHigherPriorityTaskWoken );
}
//------------------------------------------------------------------------------
void Proto_Init(void) //
{

	  /* Enable GPIOC clock */
	  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOC, ENABLE);

	  /* Enable USART6 clock */
	  RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART6, ENABLE);

	  GPIO_InitTypeDef GPIO_InitStructure;
	  /* Configure port as pushpull, 50MHz and No pull up & down  */
	  GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
	  GPIO_InitStructure.GPIO_PuPd  = GPIO_PuPd_NOPULL;
	  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;

	  /* Configure PC6 as alternate function  */
	  GPIO_InitStructure.GPIO_Mode  = GPIO_Mode_AF;
	  GPIO_InitStructure.GPIO_Pin   = GPIO_Pin_6;
	  GPIO_Init(GPIOC, &GPIO_InitStructure);

	  /* Configure PC7 as alternate function  */
	  GPIO_InitStructure.GPIO_Mode  = GPIO_Mode_AF;
	  GPIO_InitStructure.GPIO_Pin   = GPIO_Pin_7;
	  GPIO_Init(GPIOC, &GPIO_InitStructure);

	  /* Connect PC6 to USART6_Tx*/
	  GPIO_PinAFConfig(GPIOC, GPIO_PinSource6, GPIO_AF_USART6);

	  /* Connect PC7 to USART6_Rx*/
	  GPIO_PinAFConfig(GPIOC, GPIO_PinSource7, GPIO_AF_USART6);

	   NVIC_PriorityGroupConfig( NVIC_PriorityGroup_4 );

	   NVIC_InitTypeDef NVIC_InitStructure;

	   /* Place the vector table into FLASH */
	   //NVIC_SetVectorTable(NVIC_VectTab_FLASH, 0x0);

	   /* Enabling interrupt from USART1 */
	   NVIC_InitStructure.NVIC_IRQChannel = USART6_IRQn;
	   NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 14;
	   NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
	   NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
	   NVIC_Init(&NVIC_InitStructure);



	USART_InitTypeDef USART_InitStructure;

		USART_DeInit(USART6);

	USART_InitStructure.USART_BaudRate = 57600;
	USART_InitStructure.USART_WordLength = USART_WordLength_8b;
	USART_InitStructure.USART_StopBits = USART_StopBits_1;
	USART_InitStructure.USART_Parity = USART_Parity_No;
	USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
	USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;
	USART_Init(USART6, &USART_InitStructure);

	USART_ClearFlag(USART6, USART_FLAG_CTS | USART_FLAG_LBD  | USART_FLAG_TC  | USART_FLAG_RXNE );

	USART_ITConfig(USART6, USART_IT_TC, ENABLE);
	USART_ITConfig(USART6, USART_IT_RXNE , ENABLE);

	USART_Cmd(USART6, ENABLE);
	NVIC_EnableIRQ(USART6_IRQn);

	//------------------------ла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓЛю--------------------------------

	crc_n_ERR=0x0;	//ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ crc_n
	COMMAND_ERR=0x0;//ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬Хла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алалЈ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░

	//TransferBuf=&RecieveBuf[0];	 //ла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎ ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ =ла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎ ла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬░
	TransferBuf=&tab.uart_buf;
	RecieveBuf= &tab.uart_buf;
	ChannelsInit();


	//Restore_Dev_Address_Desc();

	recieve_count=0x0;//ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёбла┬алалІлалєлаРђџлалІла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛю ла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░
	transf_count=0x0;//ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёбла┬алалІлалєлаРђџлалІла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛю ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬а
	buf_len=0x0;//ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алаРђЎлњ┬▒ла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░
	//DE_RE=0;//ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ
	CUT_OUT_NULL=0;

	 xTaskCreate(ProtoProcess,(signed char*)"PROTO",128,NULL, tskIDLE_PRIORITY + 1, NULL);

	vSemaphoreCreateBinary( xProtoSemaphore );
	return;
}
//-----------------------------------------------------------------------------
uint8_t Send_Info(void) //using 0    //ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алалјл▓лѓЛъла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬▒ ла┬алалІлалјл▓лѓЛџла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬х
{
		uint8_t    i=0;

	   //ла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓЛю ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░---
	   TransferBuf[0]=0x00;
	   TransferBuf[1]=0xD7;
	   TransferBuf[2]=0x29;
	   //------------------
	   TransferBuf[3]=ADRESS_DEV;  // ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алалІла┬алАРђю ла┬алалІлалјл▓лѓЛџла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░
	   TransferBuf[4]=GET_DEV_INFO_RESP;  // ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐й ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓ№┐й
	   TransferBuf[6]=STATE_BYTE;

	   for(i=0;i<20;i++)
	   {				  // ла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алАРђюла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬хла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬х ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ
			   if(i<DEVICE_NAME_LENGTH_SYM)
			   {
			     	TransferBuf[i+7]=DEV_NAME[i];
			   }
			   else
			   {
			   		TransferBuf[i+7]=0x00;
			   }
		}

	   for(i=0;i<5;i++)                   // ла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алАРђюла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ ла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬ал▓лѓРёќ ла┬алњ┬алалјлАЛЪла┬алњ┬алалєлаРђџл▓лѓЛюла┬алњ┬ала┬ал▓Рђџ┬г
	   {
	       if(i<DEVICE_VER_LENGTH_SYM)
		   {
		    	 TransferBuf[i+27]=VERSION[i];
		   }
	   }

	   TransferBuf[32]=CHANNEL_NUMBER;		   // ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬хла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬а

	   for(i=0;i<CHANNEL_NUMBER;i++)				   // ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаРђЎлњ┬х ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алалІлалјл▓лѓЛџ
       {
		  	TransferBuf[i*2+33]=((channels[i].settings.set.type)<<4)|channels[i].settings.set.modific; // ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІлалєлаРђџлАРёб ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д
		  	TransferBuf[i*2+33+1]=0x00;							// ла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬ала┬ал▓лѓ┬а ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІлалєлаРђџлАРёб
	   }
	   for(i=0;i<dev_desc_len;i++)					// ла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алАРђюла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬х
	   {
			 TransferBuf[i+33+CHANNEL_NUMBER*2]=NOTICE[i];
	   }

	   TransferBuf[5]=28+CHANNEL_NUMBER*2+dev_desc_len;			// ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬алАРђюла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёб ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊ ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д
	   TransferBuf[33+CHANNEL_NUMBER*2+dev_desc_len]=CRC_Check(&TransferBuf[1],32+CHANNEL_NUMBER*2+dev_desc_len); // ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬алАРђюла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёб ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬алаРђ░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђю ла┬алалІла┬алАРђюла┬алалІлалјл▓лѓЛџла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алалјл┐ЛЌлЁла┬алалІлалєлаРђџл▓РђъРђЊ

	return (34+CHANNEL_NUMBER*2+dev_desc_len);
}
//-----------------------------------------------------------------------------
uint8_t Node_Full_Init(void) //using 0 //ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алалЈ ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ ла┬алалІлалјл▓лѓЛџла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░
{
	return 0;
}
//-----------------------------------------------------------------------------
uint8_t Channel_List_Init(void) //using 0 //ла┬алњ┬алаЛЌлАРђћлаРђдла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬а ла┬алалІлалјл▓лѓЛџла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ (ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬и ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д);
{
	return 0;
}
//-----------------------------------------------------------------------------
uint8_t Channel_Get_Data(void) //using 0 //ла┬алњ┬алалєлаРђџл▓РђъЛъла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алалІла┬алаРђ░ ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаРђЎлњ┬х ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁ, ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬▒ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬ал▓лѓРёќла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђю ла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалјл▓лѓЛџла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓ№┐й;
{
	return 0;
}
//-----------------------------------------------------------------------------
uint8_t  Channel_Set_Parameters(void) //using 0 //ла┬алњ┬ала┬ал▓Рђџ┬гла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алалІлалєлаРђџлАРёбла┬алалІла┬алаРђ░ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алалІлалєлаРђџл▓РђъРђЊ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁ, ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬▒ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬ал▓лѓРёќла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђю ла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалјл▓лѓЛџла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓ№┐й;
{
	 uint8_t   index=0, store_data=0;//i=0;
	 uint8_t len=0,i=0;

	   while(index<(RecieveBuf[5]-1))				   // ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаРђЎлњ┬х ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁ
	      {
			  	if(RecieveBuf[6+index]<CHANNEL_NUMBER)
			    {
					switch((RecieveBuf[6+index+1]>>4)&0xF)
					{
//					 		case CHNL_ADC://ла┬алњ┬алалјл▓лѓРёбла┬алњ┬алаРђЎлњ┬дла┬алњ┬алалјлАЛЪ
//							{
//								if((channels[RecieveBuf[6+index]].settings.set.modific!=RecieveBuf[6+index+1])||(channels[RecieveBuf[6+index]].settings.set.state_byte_1!=RecieveBuf[6+index+2]) || (channels[RecieveBuf[6+index]].settings.set.state_byte_2!=RecieveBuf[6+index+3]))
//								{
//									channels[RecieveBuf[6+index]].settings.set.state_byte_1=RecieveBuf[6+index+2];
//									channels[RecieveBuf[6+index]].settings.set.state_byte_2=RecieveBuf[6+index+3];
//									channels[RecieveBuf[6+index]].settings.set.modific	   =RecieveBuf[6+index+1]&0xF;
//									//debug----------------
//									//if(channels[RecieveBuf[6+index]].settings.set.modific==3)
////									{
////										GPIOC->ODR |= GPIO_Pin_8;
////									}
//									//-----------------
//									store_data=1;
//
//								}
//								index=index+1;
//							}
//							break;

//							case 0x2://ла┬алалІлалєлаРђџлалІла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎ
//							{
//							/*   if(channels[RecieveBuf[6+index]].settings.set.state_byte_1!=RecieveBuf[6+index+2])
//							   {
//							   		channels[RecieveBuf[6+index]].settings.set.state_byte_1=RecieveBuf[6+index+2];
//									store_data=1;
//							   }*/
//							}
//							break;

							case CHNL_DEV_STATE://ла┬алалІлалјл▓лѓЛџла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛюла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д ла┬алњ┬ала┬ал▓лѓ┬ала┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬а
							{
								switch((RecieveBuf[6+index+1])&0xF)
								{
									case CHNL_DEV_STATE_GET:
									{

									}
									break;

									case CHNL_DEV_STATE_SET:
									{
										tab.buz.buzzer_effect=(RecieveBuf[8+index]>>1)&0x7;
										tab.buz.buzzer_enable=RecieveBuf[8+index]&0x1;
										index+=CHNL_DEV_STATE_SET_LEN;
									}
									break;

									case CHNL_DEV_STATE_GET_SET:
									{

									}
									break;
								}
							}
							break;

							case CHNL_MEMORY://
							{
								for(i=0;i<RecieveBuf[8+index];i++)
								{
									tab.tablo_proto_buf[i]=RecieveBuf[8+index+i+1];
								}

								tablo_proto_parser(&tab.tablo_proto_buf);
								index+=RecieveBuf[6+2+index]+3;
							}
					}
				}
				else
				{
					return Request_Error(FR_UNATTENDED_CHANNEL);
				}
		  }
	   if(store_data)
	   {
	   		//Store_Channels_Data();	//ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлњ┬дла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁ ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬а ла┬алњ┬ала┬ал▓лѓ┬а ла┬алњ┬алалјлАЛЪла┬алњ┬алалјлАЛЪла┬алњ┬алалєлаРђџл▓лѓЛюла┬алњ┬ала┬ал▓Рђџ┬г
		}
	   return Request_Error(FR_SUCCESFUL);
}
//-----------------------------------------------------------------------------
uint8_t Channel_Set_Order_Query(void) //using 0 //ла┬алњ┬алалєлаРђџл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алалІла┬алаРђ░ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬алаРђ░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алалІла┬алаРђ░ ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬░;
{
	return 0;
}
//-----------------------------------------------------------------------------
uint8_t Channel_Get_Data_Order(void) //using 0 //ла┬алњ┬алалєлаРђџл▓РђъЛъла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алалІла┬алаРђ░ ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаРђЎлњ┬х ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁ, ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬алаРђ░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬░;
{
	return 0;
}
//-----------------------------------------------------------------------------
uint8_t Channel_Set_State(void) //using 0 //ла┬алњ┬ала┬ал▓Рђџ┬гла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алалІлалєлаРђџлАРёбла┬алалІла┬алаРђ░ ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алалЈла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁ, ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬▒ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬ал▓лѓРёќла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђю ла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалјл▓лѓЛџла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓ№┐й;
{
	return 0;
}
//-----------------------------------------------------------------------------
uint8_t  Channel_Get_Data_Order_M2(void) //using 0 //ла┬алњ┬алалєлаРђџл▓РђъЛъла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алалІла┬алаРђ░ ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаРђЎлњ┬х ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁ, ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬╗ла┬алалІла┬алаРђ░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬░;
{
	return 0;
}
//-----------------------------------------------------------------------------
uint8_t Channel_Set_Reset_State_Flags(void) //using 0 //	ла┬алњ┬ала┬ал▓Рђџ┬гла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░/ла┬алњ┬ала┬алаРђ╣ла┬алњ┬алаРђЎлњ┬▒ла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђю ла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъла┬алњ┬ала┬ал▓лѓ┬а ла┬алалІла┬алАРђюла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алалЈла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬алалЈ
{
	STATE_BYTE=0x40;
	return	Request_Error(FR_SUCCESFUL);//ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёб, ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬Хла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬хла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬х
}
//-----------------------------------------------------------------------------
uint8_t Channel_All_Get_Data(void) //using 0 //ла┬алњ┬алалєлаРђџл▓РђъЛъла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алалІла┬алаРђ░ ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџлАРђ║ла┬алњ┬алалјл▓лѓЛъла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬ал▓лѓРёќ ла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬ала┬ал▓лѓ┬ала┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬хла┬алњ┬алалјл┐ЛЌлЁ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл┐ЛЌлЁ ла┬алалІлалјл▓лѓЛџла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░ (ла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алАРђюла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алалјл▓лѓ№┐йла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алалєл▓лѓЛЏл▓лѓРђю ла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алњ┬алаРђЎлњ┬Хла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл┐ЛЌлЁ);
{
	   uint8_t  index=0,i=0;


	   TransferBuf[0]=0x00;TransferBuf[1]=0xD7;TransferBuf[2]=0x29;
	   TransferBuf[3]=ADRESS_DEV;  //
	   TransferBuf[4]=CHANNEL_ALL_GET_DATA_RESP;  //
	   TransferBuf[6]=STATE_BYTE;
	    for(i=0;i<CHANNEL_NUMBER;i++)				   //
	    {
			  TransferBuf[index+7]=i;
			  index++;
			  TransferBuf[index+7]=((channels[i].settings.set.type)<<4)|channels[i].settings.set.modific; //
			  index++;
			  switch(channels[i].settings.set.type)
			    {
					 case 0:  //
					 {
						 switch(channels[i].settings.set.modific)
		                 {
							  case 0:
							  {
							  		if(channels[i].calibrate.cal.calibrate)//
									{
									//	 if(channels[i].settings.set.modific==0x00 || channels[i].settings.set.modific==0x01)
									//	 {
										 	TransferBuf[index+7]=((channels[i].channel_data_calibrate)&0x0000FF00)>>8;
										  	index++;
				    					  	TransferBuf[index+7]=((channels[i].channel_data_calibrate)&0x00FF0000)>>16;
										  	index++;
									//	 }
									}
									else
									{
										// if(channels[i].settings.set.modific==0x00 || channels[i].settings.set.modific==0x01)		   //
									//	 {
											TransferBuf[index+7]=((channels[i].channel_data)&0x0000FF00)>>8;
										  	index++;
				    					  	TransferBuf[index+7]=((channels[i].channel_data)&0x00FF0000)>>16;
										  	index++;
										// }
									}


									  TransferBuf[index+7]=channels[i].settings.set.state_byte_1;	 //
			                          index++;
			                          TransferBuf[index+7]=channels[i].settings.set.state_byte_2;	 //
				                      index++;
							  }
							  break;

							  case 1:
							  {
							  }
							  break;

				        	  case 2:
							  {
							  }
							  break;

							  case 3:
							  {
							        if(channels[i].calibrate.cal.calibrate)//
									{
							 			// if(channels[i].settings.set.modific==0x02 || channels[i].settings.set.modific==0x03)		   //
									//	 {
										  	TransferBuf[index+7]=((channels[i].channel_data_calibrate)&0x000000FF); //
								          	index++;
										  	TransferBuf[index+7]=((channels[i].channel_data_calibrate)&0x0000FF00)>>8;
										  	index++;
				    					  	TransferBuf[index+7]=((channels[i].channel_data_calibrate)&0x00FF0000)>>16;
										  	index++;
			  						  	// }
									}
									else
									{
									//	 if(channels[i].settings.set.modific==0x02 || channels[i].settings.set.modific==0x03)		   //
										// {
										  	TransferBuf[index+7]=((channels[i].channel_data)&0x000000FF); //
								          	index++;
										  	TransferBuf[index+7]=((channels[i].channel_data)&0x0000FF00)>>8;
										  	index++;
				    					  	TransferBuf[index+7]=((channels[i].channel_data)&0x00FF0000)>>16;
										  	index++;
									//	 }
									}


									  TransferBuf[index+7]=channels[i].settings.set.state_byte_1;	 //
			                          index++;
			                          TransferBuf[index+7]=channels[i].settings.set.state_byte_2;	 //
				                      index++;
							  }
							  break;
						  }
					  }
					  break;

				 	case 1:	 //ла┬ал▓лѓЛџлалєлаРђџлАРђ║ла┬ал▓лѓЛџла┬ал▓лѓРёќла┬ал▓лѓЛџлалєлаРђџл▓РђъРђЊ
					{
						  switch(channels[i].settings.set.modific)
					      {
								  case 0:
								  {
								          TransferBuf[index+7]=((channels[i].channel_data)&0x000000FF); //
								          index++;

										  TransferBuf[index+7]=((channels[i].channel_data)&0x0000FF00)>>8;
										  index++;

								          TransferBuf[index+7]=((channels[i].channel_data)&0x00FF0000)>>16; //
								          index++;

										  TransferBuf[index+7]=((channels[i].channel_data)&0xFF000000)>>24;
										  index++;


										  TransferBuf[index+7]=channels[i].settings.set.state_byte_1;	 //
				                          index++;
								  }
								  break;
						   }
					}
					break;

					 case 2: //
					 {
						  switch(channels[i].settings.set.modific)
					      {
								  case 1:
								  {
								          TransferBuf[index+7]=((channels[i].channel_data)&0x000000FF); //
								          index++;
										  TransferBuf[index+7]=((channels[i].channel_data)&0x0000FF00)>>8;
										  index++;
										  TransferBuf[index+7]=channels[i].settings.set.state_byte_1;	 //
				                          index++;
								  }
								  break;
						   }
					  }
					  break;
			  }
		   }

		  TransferBuf[5]=index+2; 						 //
		  TransferBuf[index+7]=CRC_Check(&TransferBuf[1],(uint8_t)(index+7)-1); //
		  return (uint8_t)(7+index+1);
}

uint8_t Request_Error(uint8_t error_code) //using 0 //	ла┬алњ┬алалјл▓лѓЛћла┬алалІлалєл▓лѓЛЎлњ┬гла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлалІла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алњ┬алалєл▓лѓЛЏл▓лѓРђю ла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђю/ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алњ┬алаРђЎлњ┬хла┬алалІлалєлаРђџлАРёб;
{
	TransferBuf[0]=0x00;TransferBuf[1]=0xD7;TransferBuf[2]=0x29;
    TransferBuf[3]=ADRESS_DEV;  // ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬хла┬алалІла┬алАРђю ла┬алалІлалјл▓лѓЛџла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░
    TransferBuf[7]=RecieveBuf[4]; // ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐й ла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалєл▓лѓЛЏл▓лѓРђю ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаЛъл▓лѓ№┐йла┬алалІлалєлаРђџл▓РђъРђЊ
    TransferBuf[4]=0xFF;  // ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаЛъл▓лѓ№┐й ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђЮла┬алњ┬алаРђЎлњ┬хла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлњ┬ала┬алњ┬алалјл▓лѓ№┐йла┬алњ┬алалјл▓лѓ№┐й

	TransferBuf[6]=STATE_BYTE; // ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалєл▓лѓЛЏл▓лѓРђюла┬алалІлалєлаРђџлАРёб ла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬алаРђЎлњ┬░ла┬алалІлалєлаРђџлАРёбла┬алалІлалјл▓лѓЛџла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬░ ла┬алалІлалјл▓лѓЛџла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алаРђЎлњ┬░
    TransferBuf[8]=error_code;
    TransferBuf[5]=0x04;	  // ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬╗ла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬░ ла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬ала┬ал▓лѓ┬дла┬алалІлалєлаРђџл▓РђъРђЊла┬алалІлалєлаРђџлњ┬д
    TransferBuf[9]=CRC_Check(TransferBuf,9);
	return 10;
}
//-----------------------------------------------------------------------------
void ProtoBufHandling(void) //using 0 //ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлњ┬ала┬алњ┬алаРђЎлњ┬хла┬алалІла┬алАРђюла┬алалІла┬алАРђю ла┬алњ┬алалјл▓лѓЛъла┬алњ┬алаРђЎлњ┬▒ла┬алалІла┬ал▓лѓЛЎла┬алњ┬алаРђЎлњ┬░ла┬алњ┬алаРђЎлњ┬▒ла┬алњ┬алалјл▓лѓЛъла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓ№┐й ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓ№┐йла┬алњ┬ала┬ал▓лѓ┬дла┬алалІла┬алалЈла┬алалІлалєлаРђџлАРёбла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл▓лѓРђюла┬алњ┬алалјл▓лѓЛъ ла┬алњ┬алаРђЎлњ┬ила┬алњ┬алаРђЎлњ┬░ла┬алњ┬алалјл▓лѓРђЮла┬алалІла┬ал▓лѓЛЎла┬алњ┬алалјл▓лѓЛъла┬алалІла┬алАРђюла┬алњ┬алаРђЎлњ┬░
{
  switch(RecieveBuf[4])
  {
//---------------------------------------
  	case GET_DEV_INFO_REQ:
	{
		buf_len=Send_Info();
	}
	break;
//---------------------------------------
  	case NODE_FULL_INIT_REQ:
	{
		buf_len=Node_Full_Init();
	}
	break;
//---------------------------------------
  	case CHANNEL_LIST_INIT_REQ:
	{
		buf_len=Channel_List_Init();
	}
	break;
//---------------------------------------
	case CHANNEL_GET_DATA_REQ:
	{
		buf_len=Channel_Get_Data();
	}
	break;
	//-----------------------------------
	case CHANNEL_SET_PARAMETERS_REQ:
	{
		buf_len=Channel_Set_Parameters();
	}
	break;
	//-----------------------------------
	case CHANNEL_SET_ORDER_QUERY_REQ:
	{
		buf_len=Channel_Set_Order_Query();
	}
	break;
//----------------------------------------
	case CHANNEL_GET_DATA_ORDER_REQ:
	{
		 buf_len=Channel_Get_Data_Order();
	}
	break;
//----------------------------------------
	case CHANNEL_SET_STATE_REQ:
	{
		 buf_len=Channel_Set_State();
	}
	break;
//----------------------------------------
	case CHANNEL_GET_DATA_ORDER_M2_REQ:
	{
		 buf_len=Channel_Get_Data_Order_M2();
	}
	break;
//------------------------------------------
	case CHANNEL_SET_RESET_STATE_FLAGS_REQ:
	{
		buf_len=Channel_Set_Reset_State_Flags();
	}
	break;
//------------------------------------------
	case CHANNEL_ALL_GET_DATA_REQ:
	{
		 buf_len=Channel_All_Get_Data();
	}
	break;
//------------------------------------------
/*	case CHANNEL_SET_ADDRESS_DESC:
	{
		 buf_len=Channel_Set_Address_Desc();
	}
	break;
//------------------------------------------
	case CHANNEL_SET_CALIBRATE:
	{
		 buf_len=Channel_Set_Calibrate();
	}
	break;*/
//------------------------------------------
    default:
	{
       COMMAND_ERR=0x1;//ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаРђЎлњ┬хла┬алалІла┬алАРђюла┬алалІлалјл▓лѓЛџла┬алалІлалєлаРђџлњ┬░ла┬алњ┬алаРђЎлњ┬хла┬алалІла┬алАРђюла┬алалІлалєлаРђџлАРёбла┬алњ┬ала┬ал▓лѓ┬ала┬алалІлалјл▓лѓЛџла┬алалІла┬ал▓лѓРёќла┬алалІлалєлаРђџлњ┬░ла┬алњ┬алаРђЎлњ┬░ла┬алалІла┬алалЈ ла┬алњ┬алалјл▓лѓЛюла┬алњ┬алалјл▓лѓЛъла┬алњ┬алалјл┐ЛЌлЁла┬алњ┬алаРђЎлњ┬░ла┬алњ┬ала┬ал▓лѓ┬дла┬алњ┬алаЛъл▓лѓ№┐йла┬алњ┬алаРђЎлњ┬░
	   buf_len=Request_Error(FR_COMMAND_NOT_EXIST);
    }
  }

  return;
}
//-----------------------------------------------------------------------------------
void ProtoProcess( void *pvParameters )
{
	uint8_t   crc_n;
	while(1)
	{
		if( xProtoSemaphore != NULL )
		{
			if( xSemaphoreTake( xProtoSemaphore, ( portTickType ) PROTO_STANDBY_TIME ) == pdTRUE )
			{
				switch(proto_type)
				{
					case PROTO_TYPE_OLD:
					{
						tablo_proto_parser(&tab.tablo_proto_buf);
						recieve_count=0x0;
						USART_ITConfig(USART6, USART_IT_RXNE , ENABLE);
					}
					break;

					case PROTO_TYPE_NEW:
					{
						crc_n=RecieveBuf[recieve_count-1];
						transf_count=0;
						if(CRC_Check(RecieveBuf,(recieve_count-CRC_LEN))==crc_n)
						{

							ProtoBufHandling();//

							transf_count=0;
							recieve_count=0;
							CUT_OUT_NULL=0;

							//USART_SendData(USART6,/*TransferBuf[transf_count]*/tab.uart_buf[transf_count]);
							USART6->DR =TransferBuf[transf_count];
							transf_count++;//
						}
						else
						{
							crc_n_ERR=0x1;//
							USART_ITConfig(USART6, USART_IT_RXNE , ENABLE);
						}
					}
					break;
				}
			}
			else
			{
				tablo_proto_parser(&standby_frame);//
			}
		}
	}
}
//-----------------------crc_n------------------------------------------------------------
uint8_t  CRC_Check( uint8_t  *Spool_pr,uint8_t Count_pr )
{
	uint8_t crc_n = 0;
	uint8_t  *Spool;
	uint8_t  Count ;

	Spool=Spool_pr;
	Count=Count_pr;

  		while(Count!=0x0)
        {
	        crc_n = crc_n ^ (*Spool++);//

	        crc_n = ((crc_n & 0x01) ? (uint8_t)0x80: (uint8_t)0x00) | (uint8_t)(crc_n >> 1);

	        if (crc_n & (uint8_t)0x80) crc_n = crc_n ^ (uint8_t)0x3C;
			Count--;
        }
    return crc_n;
}
 //-----------------------------------------------------------------------------------------------

